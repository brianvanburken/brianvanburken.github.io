<!DOCTYPE html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:,"><style>html{background:#0b0e14;color:#fff}body{font-family:Avenir Next,Open Sans,Helvetica,sans-serif;font-size:1.125rem;margin:1.5rem auto;max-width:70ch;padding:0 1.5rem}article,code,footer,h1,h2,h3,p,pre{line-height:1.5rem;margin:1.5rem 0}h1{font-size:2.5rem;line-height:3rem}p{text-align:justify}img{max-width:100%}h2{margin-top:3rem}a{color:#fa3}a:visited{color:#ff9500}a:focus,a:hover{color:#ffbf66}footer{border-top:1px solid #bfbdb6;padding-top:1.5rem}code,pre{font-size:.875rem;word-break:normal;word-spacing:normal;word-wrap:normal;background:#0b0e14;border-radius:.375rem;color:#bfbdb6;hyphens:none}pre{overflow:auto;padding:1.5rem}p code{line-height:1;margin:0 2px;outline:3px solid #0b0e14}@media (prefers-color-scheme:light){html{background:#fff;color:#0b0e14}}.c{color:#f29668}.f{color:#ffb454}.g{color:#d2a6ff}.h{color:#59c2ff}.i{color:#95e6cb}.j{color:#39bae6}.k{color:#bfbdb6b3}.d{color:#ff8f40}.e{color:#aad94c}</style><link type="application/atom+xml" rel="alternate" href="https://brianvanburken.nl/feed.xml" title="Brian van Burken"><title>Caching Elm dependencies on Github Actions | Brian van Burken</title><meta name="generator" content="Jekyll v4.4.1"><meta property="og:title" content="Caching Elm dependencies on Github Actions"><meta property="og:locale" content="en_US"><meta name="description" content="When working with Elm in GitHub Actions, caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures."><meta property="og:description" content="When working with Elm in GitHub Actions, caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures."><link rel="canonical" href="https://brianvanburken.nl/caching-elm-dependencies-on-github-actions/"><meta property="og:url" content="https://brianvanburken.nl/caching-elm-dependencies-on-github-actions/"><meta property="og:site_name" content="Brian van Burken"><meta property="og:type" content="article"><meta property="article:published_time" content="2025-02-07T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Caching Elm dependencies on Github Actions"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-30T15:07:32+00:00","datePublished":"2025-02-07T00:00:00+00:00","description":"When working with Elm in GitHub Actions, caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures.","headline":"Caching Elm dependencies on Github Actions","mainEntityOfPage":{"@type":"WebPage","@id":"https://brianvanburken.nl/caching-elm-dependencies-on-github-actions/"},"url":"https://brianvanburken.nl/caching-elm-dependencies-on-github-actions/"}</script><p><a href="/" title="Overview of all my writings">Writings</a> | <a href="https://github.com/brianvanburken" title="Visit my GitHub profile" target="_blank" rel="noopener noreferrer">GitHub</a> | <a href="https://linkedin.com/in/brianvanburken" title="Visit my LinkedIn profile" target="_blank" rel="noopener noreferrer">LinkedIn</a><article itemscope itemtype="http://schema.org/BlogPosting"><h1 itemprop="name headline">Caching Elm dependencies on Github Actions</h1><section itemprop="articleBody"><p>When working with Elm in GitHub Actions, caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures.<h2 id="where-does-elm-store-its-dependencies">Where does Elm store its dependencies?</h2><p>Elm stores downloaded dependencies inside a hidden <code>.elm</code> directory in the user’s home folder by default. On most systems, this directory is located at:<pre tabindex="0"><code><span class="c">~</span>/.elm
</code></pre><p>We can change the location where dependencies are stored by setting the <code>ELM_HOME</code> environment variable in your shell. This allows us to relocate the <code>.elm</code> directory to a location we control.<p>For example, we can move it to follow the <a href="https://specifications.freedesktop.org/basedir-spec/latest/" target="_blank" rel="noopener noreferrer">XDG Base Directory Specification</a>:<pre tabindex="0"><code><span class="d">export</span> ELM_HOME<span class="c">=</span><span class="e">"</span>$HOME<span class="e">/.cache/elm"</span>
</code></pre><h2 id="how-can-we-only-install-elm-dependencies">How can we only install Elm dependencies?</h2><p>Unlike other package managers, Elm does not have a separate install command to fetch dependencies without compiling a project. Dependencies are only downloaded when Elm compiles a file in the project. Compiling the entire project could work, but it may be slow. However, there is a trick to circumvent this.<h3 id="using-a-temporary-file">Using a temporary file</h3><p>A workaround is to create a minimal valid Elm file that triggers dependency installation without requiring the compilation of the entire project. Below is an example:<pre tabindex="0"><code><span class="d">module</span> A <span class="d">exposing</span> (<span class="f">a</span>)
<span class="f">a</span><span class="d"> =</span><span class="g"> 0</span>
</code></pre><p>Then, we create this file and compile it to download dependencies without affecting the main project. The compilation result is directed to <code>/dev/null</code>, so it is discarded automatically without leaving any artifacts:<pre tabindex="0"><code><span class="h">elm</span><span class="e"> make Temp.elm</span><span class="i"> --output=/dev/null</span>
</code></pre><h3 id="no-lockfile">No Lockfile?</h3><p>Elm does not have the concept of a “lockfile.” Instead, the <code>elm.json</code> file stores exact package versions. This means we can base the cache on the <code>elm.json</code> file. However, one downside is that any modification to elm.json—such as changing the Elm package version—will trigger a cache invalidation, even if dependencies remain unchanged.<h2 id="adding-caching-to-github-actions">Adding caching to GitHub Actions</h2><p>Now, let’s put everything together in a GitHub Actions pipeline.<h3 id="1-set-the-elm_home-environment-variable">1. Set the ELM_HOME Environment Variable</h3><p>Modify your GitHub Actions workflow to define the <code>ELM_HOME</code> path at the root level for consistency across runs. Here, we set it to the project’s root:<pre tabindex="0"><code><span class="j">env</span><span class="k">:</span>
<span class="j">  ELM_HOME</span><span class="k">:</span><span class="e"> ".elm"</span>
</code></pre><h3 id="2-add-a-cache-rule-for-the-elm-directory">2. Add a cache rule for the .elm directory</h3><p>Use the <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/caching-dependencies-to-speed-up-workflows" target="_blank" rel="noopener noreferrer">GitHub cache action</a> to persist dependencies between workflow runs. This should go in the <code>steps:</code> section of the workflow file.<pre tabindex="0"><code>- <span class="j">name</span><span class="k">:</span><span class="e"> Cache Elm dependencies</span>
<span class="j">  id</span><span class="k">:</span><span class="e"> elm_cache</span>
<span class="j">  uses</span><span class="k">:</span><span class="e"> actions/cache@v3</span>
<span class="j">  with</span><span class="k">:</span>
<span class="j">    path</span><span class="k">:</span><span class="e"> .elm</span>
<span class="j">    key</span><span class="k">:</span><span class="e"> elm-${{ runner.os }}-${{ hashFiles('elm.json') }}</span>
</code></pre><p>This ensures that dependencies are only redownloaded when <code>elm.json</code> changes, as its content is used as the cache key. We set an <code>id</code> so that we can reference it to check for cache hits.<h3 id="3-install-dependencies-using-the-temporary-file-trick">3. Install dependencies using the temporary file trick</h3><p>To ensure all dependencies are installed before the main build step, use the following command to create a temporary file and compile it, forcing dependency installation. This should also be included in the <code>steps:</code> section of the workflow file.<pre tabindex="0"><code>- <span class="j">name</span><span class="k">:</span><span class="e"> Install Elm dependencies</span>
<span class="j">  if</span><span class="k">:</span><span class="e"> steps.elm_cache.outputs.cache-hit != 'true'</span>
<span class="j">  run</span><span class="k">:</span><span class="d"> |</span>
<span class="e">    echo "module A exposing (a)\na=0" &gt; Temp.elm
    elm make Temp.elm --output=/dev/null
    rm Temp.elm</span>
</code></pre><p>This step will be skipped if the cache is hit, meaning <code>elm.json</code> has not changed.</section><footer>Published on <time datetime="2025-02-07T00:00:00+00:00" itemprop="datePublished">2025-02-07 </time><br>Tags: <a href="/tags/#elm" title="See all post for Elm">Elm</a>, <a href="/tags/#github-actions" title="See all post for Github Actions">Github Actions</a><br>Source <a href="https://github.com/brianvanburken/brianvanburken.github.io/tree/master/_posts/2025-02-07-caching-elm-dependencies-on-github-actions.md" target="_blank" rel="noopener noreferrer">on Github</a></footer></article><script data-goatcounter="https://brianvanburken.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script><noscript><img src="https://brianvanburken.goatcounter.com/count?p=/caching-elm-dependencies-on-github-actions/"></noscript>