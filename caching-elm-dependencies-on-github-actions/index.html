<!DOCTYPE html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/atom+xml title="RSS Feed" href=https://brianvanburken.nl/feed.xml><title>Caching Elm dependencies on Github Actions | Brian van Burken</title><meta property=og:title content="Caching Elm dependencies on Github Actions"><meta name=description content="Caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures."><meta property=og:description content="Caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures."><meta property=og:type content=article><meta property=og:url content=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;caching-elm-dependencies-on-github-actions&#x2F;><meta property=og:site_name content="Brian van Burken"><link rel=canonical href=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;caching-elm-dependencies-on-github-actions&#x2F;><meta property=article:published_time content=2025-02-07T00:00:00+00:00><style>html{color:#fff;background:#0b0e14}@media (prefers-color-scheme:light){html{color:#0b0e14;background:#fff}}body{font-family:"Avenir Next","Open Sans",Helvetica,sans-serif;font-size:1.125rem;max-width:70ch;margin:1.5rem auto;padding:0 1.5rem}article,code,footer,h1,h2,h3,p,pre{margin:1.5rem 0;line-height:1.5rem}h1{font-size:2.5rem;line-height:3rem}p{text-align:justify}img{max-width:100%}h2{margin-top:3rem}a,a code{color:#fa3}a:visited{color:#ff9500}a:focus,a:hover{color:#ffbf66}footer{border-top:1px solid #bfbdb6;padding-top:1.5rem}code,pre{font-size:.875rem;word-spacing:normal;word-break:normal;word-wrap:normal;hyphens:none;color:#bfbdb6;background:#0b0e14;border-radius:.375rem}pre{overflow:auto;padding:1.5rem}p code{line-height:1;outline:3px solid #0b0e14;margin:0 2px}.d{color:#ff8f40}.h{color:#59c2ff}.c{color:#bfbdb6}.b{color:#f29668}.j{color:#39bae6}.k{color:#bfbdb6b3}.e{color:#aad94c}.f{color:#ffb454}.g{color:#d2a6ff}.i{color:#95e6cb}</style><p><a href=/ title="Overview of all my writings">Writings</a> | <a href=https://github.com/brianvanburken title="Visit my GitHub profile" target=_blank rel="noopener noreferrer">GitHub</a> | <a href=https://linkedin.com/in/brianvanburken title="Visit my LinkedIn profile" target=_blank rel="noopener noreferrer">LinkedIn</a><article itemscope itemtype=http://schema.org/BlogPosting><h1 itemprop="name headline">Caching Elm dependencies on Github Actions</h1><section itemprop=articleBody><p>When working with Elm in GitHub Actions, caching dependencies efficiently can significantly speed up CI runs and improve reliability, as it prevents downloading dependencies every time, reducing exposure to outages and network failures.<h2 id=where-does-elm-store-its-dependencies>Where does Elm store its dependencies?</h2><p>Elm stores downloaded dependencies inside a hidden <code>.elm</code> directory in the user’s home folder by default. On most systems, this directory is located at:<pre><code><span class=a><span class=b>~</span><span class=c>/.elm</span></span>
</code></pre><p>We can change the location where dependencies are stored by setting the <code>ELM_HOME</code> environment variable in your shell. This allows us to relocate the <code>.elm</code> directory to a location we control.<p>For example, we can move it to follow the <a rel="noopener nofollow noreferrer external" target=_blank href=https://specifications.freedesktop.org/basedir-spec/latest/ >XDG Base Directory Specification</a>:<pre><code><span class=a><span class=d>export</span><span class=c> ELM_HOME</span><span class=b>=</span><span class=e>"</span><span class=c>$HOME</span><span class=e>/.cache/elm"</span></span>
</code></pre><h2 id=how-can-we-only-install-elm-dependencies>How can we only install Elm dependencies?</h2><p>Unlike other package managers, Elm does not have a separate install command to fetch dependencies without compiling a project. Dependencies are only downloaded when Elm compiles a file in the project. Compiling the entire project could work, but it may be slow. However, there is a trick to circumvent this.<h3 id=using-a-temporary-file>Using a temporary file</h3><p>A workaround is to create a minimal valid Elm file that triggers dependency installation without requiring the compilation of the entire project. Below is an example:<pre><code><span class=a><span class=d>module</span><span class=c> A </span><span class=d>exposing</span><span class=c> (</span><span class=f>a</span><span class=c>)</span></span>
<span class=a><span class=f>a</span><span class=d> =</span><span class=g> 0</span></span>
</code></pre><p>Then, we create this file and compile it to download dependencies without affecting the main project. The compilation result is directed to <code>/dev/null</code>, so it is discarded automatically without leaving any artifacts:<pre><code><span class=a><span class=h>elm</span><span class=e> make Temp.elm</span><span class=i> --output=/dev/null</span></span>
</code></pre><h3 id=no-lockfile>No Lockfile?</h3><p>Elm does not have the concept of a “lockfile.” Instead, the <code>elm.json</code> file stores exact package versions. This means we can base the cache on the <code>elm.json</code> file. However, one downside is that any modification to elm.json—such as changing the Elm package version—will trigger a cache invalidation, even if dependencies remain unchanged.<h2 id=adding-caching-to-github-actions>Adding caching to GitHub Actions</h2><p>Now, let’s put everything together in a GitHub Actions pipeline.<h3 id=1-set-the-elm-home-environment-variable>1. Set the ELM_HOME Environment Variable</h3><p>Modify your GitHub Actions workflow to define the <code>ELM_HOME</code> path at the root level for consistency across runs. Here, we set it to the project’s root:<pre><code><span class=a><span class=j>env</span><span class=k>:</span></span>
<span class=a><span class=j>  ELM_HOME</span><span class=k>:</span><span class=e> ".elm"</span></span>
</code></pre><h3 id=2-add-a-cache-rule-for-the-elm-directory>2. Add a cache rule for the .elm directory</h3><p>Use the <a rel="noopener nofollow noreferrer external" target=_blank href=https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/caching-dependencies-to-speed-up-workflows>GitHub cache action</a> to persist dependencies between workflow runs. This should go in the <code>steps:</code> section of the workflow file.<pre><code><span class=a><span class=c>- </span><span class=j>name</span><span class=k>:</span><span class=e> Cache Elm dependencies</span></span>
<span class=a><span class=j>  id</span><span class=k>:</span><span class=e> elm_cache</span></span>
<span class=a><span class=j>  uses</span><span class=k>:</span><span class=e> actions/cache@v3</span></span>
<span class=a><span class=j>  with</span><span class=k>:</span></span>
<span class=a><span class=j>    path</span><span class=k>:</span><span class=e> .elm</span></span>
<span class=a><span class=j>    key</span><span class=k>:</span><span class=e> elm-${{ runner.os }}-${{ hashFiles('elm.json') }}</span></span>
</code></pre><p>This ensures that dependencies are only redownloaded when <code>elm.json</code> changes, as its content is used as the cache key. We set an <code>id</code> so that we can reference it to check for cache hits.<h3 id=3-install-dependencies-using-the-temporary-file-trick>3. Install dependencies using the temporary file trick</h3><p>To ensure all dependencies are installed before the main build step, use the following command to create a temporary file and compile it, forcing dependency installation. This should also be included in the <code>steps:</code> section of the workflow file.<pre><code><span class=a><span class=c>- </span><span class=j>name</span><span class=k>:</span><span class=e> Install Elm dependencies</span></span>
<span class=a><span class=j>  if</span><span class=k>:</span><span class=e> steps.elm_cache.outputs.cache-hit != 'true'</span></span>
<span class=a><span class=j>  run</span><span class=k>:</span><span class=d> |</span></span>
<span class=a><span class=e>    echo "module A exposing (a)\na=0" > Temp.elm</span></span>
<span class=a><span class=e>    elm make Temp.elm --output=/dev/null</span></span>
<span class=a><span class=e>    rm Temp.elm</span></span>
</code></pre><p>This step will be skipped if the cache is hit, meaning <code>elm.json</code> has not changed.</section><footer>Published on <time datetime=2025-02-07T00:00:00 itemprop=datePublished>2025-02-07</time><br>Tags: <a href=/tags/#elm title="See all posts for Elm">Elm</a>, <a href=/tags/#github-actions title="See all posts for Github Actions">Github Actions</a><br>Source <a href=https:&#x2F;&#x2F;github.com&#x2F;brianvanburken&#x2F;brianvanburken.github.io&#x2F;tree&#x2F;master&#x2F;content/caching-elm-dependencies-on-github-actions.md target=_blank rel="noopener noreferrer" title="View post source on Github">on Github</a></footer></article><script data-goatcounter=https://brianvanburken.goatcounter.com/count async src=https://gc.zgo.at/count.js></script><noscript><img src="https://brianvanburken.goatcounter.com/count?p=/caching-elm-dependencies-on-github-actions/"></noscript>