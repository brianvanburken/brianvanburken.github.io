<!DOCTYPE html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:,"><style>html{background:#0b0e14;color:#fff}body{font-family:Avenir Next,Open Sans,Helvetica,sans-serif;font-size:1.125rem;margin:1.5rem auto;max-width:70ch;padding:0 1.5rem}article,code,footer,h1,h2,p,pre{line-height:1.5rem;margin:1.5rem 0}h1{font-size:2.5rem;line-height:3rem}p{text-align:justify}img{max-width:100%}h2{margin-top:3rem}a{color:#fa3}a:visited{color:#ff9500}a:focus,a:hover{color:#ffbf66}footer{border-top:1px solid #bfbdb6;padding-top:1.5rem}code,pre{font-size:.875rem;word-break:normal;word-spacing:normal;word-wrap:normal;background:#0b0e14;border-radius:.375rem;color:#bfbdb6;hyphens:none}pre{overflow:auto;padding:1.5rem}p code{line-height:1;margin:0 2px;outline:3px solid #0b0e14}@media (prefers-color-scheme:light){html{background:#fff;color:#0b0e14}}.c{color:#39bae6}.d{color:#bfbdb6b3}.h{color:#ffb454}.g{color:#f29668}.e{color:#aad94c}.f{color:#ff8f40}</style><link type="application/atom+xml" rel="alternate" href="https://brianvanburken.nl/feed.xml" title="Brian van Burken"><title>Combine Properties when Decoding JSON in Elm | Brian van Burken</title><meta name="generator" content="Jekyll v4.4.1"><meta property="og:title" content="Combine Properties when Decoding JSON in Elm"><meta property="og:locale" content="en_US"><meta name="description" content="Sometimes an API returns a JSON object that contains properties you want to combine, for example, pieces of information belonging together."><meta property="og:description" content="Sometimes an API returns a JSON object that contains properties you want to combine, for example, pieces of information belonging together."><link rel="canonical" href="https://brianvanburken.nl/combine-properties-when-decoding-json-in-elm/"><meta property="og:url" content="https://brianvanburken.nl/combine-properties-when-decoding-json-in-elm/"><meta property="og:site_name" content="Brian van Burken"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-11-15T00:00:00+00:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Combine Properties when Decoding JSON in Elm"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-30T15:07:32+00:00","datePublished":"2021-11-15T00:00:00+00:00","description":"Sometimes an API returns a JSON object that contains properties you want to combine, for example, pieces of information belonging together.","headline":"Combine Properties when Decoding JSON in Elm","mainEntityOfPage":{"@type":"WebPage","@id":"https://brianvanburken.nl/combine-properties-when-decoding-json-in-elm/"},"url":"https://brianvanburken.nl/combine-properties-when-decoding-json-in-elm/"}</script><p><a href="/" title="Overview of all my writings">Writings</a> | <a href="https://github.com/brianvanburken" title="Visit my GitHub profile" target="_blank" rel="noopener noreferrer">GitHub</a> | <a href="https://linkedin.com/in/brianvanburken" title="Visit my LinkedIn profile" target="_blank" rel="noopener noreferrer">LinkedIn</a><article itemscope itemtype="http://schema.org/BlogPosting"><h1 itemprop="name headline">Combine Properties when Decoding JSON in Elm</h1><section itemprop="articleBody"><p>Sometimes an API returns a JSON object that contains properties you want to combine, for example, pieces of information belonging together.<h2 id="the-domain">The domain</h2><p>Before we look at how to solve this, let’s establish a shared domain. So let’s say we have an API that returns a list of videos when called. Each video coming from that API has the following structure:<pre tabindex="0"><code>{
<span class="c">  "id"</span><span class="d">:</span><span class="e"> "1"</span><span class="d">,</span>
<span class="c">  "extension"</span><span class="d">:</span><span class="e"> "mp4"</span><span class="d">,</span>
<span class="c">  "name"</span><span class="d">:</span><span class="e"> "example"</span>
}
</code></pre><p>Here we see that the <code>extension</code> and the <code>name</code> are separate properties of the video object. It would be nice to combine them to get the full filename and download the video. Based on the JSON object and our wish to combine properties, we can create our model in Elm.<pre tabindex="0"><code><span class="f">type alias Video</span><span class="g"> =</span>
    { id: <span class="f">String</span>
<span class="d">    ,</span> filename: <span class="f">String</span>
    }
</code></pre><h2 id="decoding">Decoding</h2><p>Now that we know our goal, we can create the decoder for our model. In this first attempt, we decode all the properties and pass them to a function. In the function, we combine the name and extension and pass it to our model.<pre tabindex="0"><code><span class="f">import</span> Json<span class="f">.</span>Decode <span class="f">as</span> JD <span class="f">exposing</span> (<span class="f">Decoder</span>)

<span class="h">decode</span><span class="f"> : Decoder Video</span>
<span class="h">decode</span><span class="f"> =
    let</span>
        toVideo <span class="f">:</span> String <span class="g">-&gt;</span> String <span class="g">-&gt;</span> String <span class="g">-&gt;</span> Decoder Video
        toVideo id extension name <span class="f">=</span>
            JD<span class="f">.</span>succeed (Video id (name <span class="g">++</span><span class="e"> "."</span><span class="g"> ++</span> extension))
<span class="f">    in</span>
    JD<span class="f">.</span>map3 toVideo
        (JD<span class="f">.</span>field <span class="e">"id"</span> JD<span class="f">.</span>string)
        (JD<span class="f">.</span>field <span class="e">"extension"</span> JD<span class="f">.</span>string)
        (JD<span class="f">.</span>field <span class="e">"name"</span> JD<span class="f">.</span>string)
</code></pre><p>This code works and does what we want. But, the code isn’t straightforward and less extensible. What if the API returns more properties that we want to use? The <code>toVideo</code> function becomes longer and less readable. It is also more error-prone, e.g., accidentally swapping arguments.<h2 id="improving-the-decoder">Improving the decoder</h2><p>We can improve this by extracting the logic of combining the name and extension into a separate custom decoder. In the decoder, we get the whole JSON object, extract only the name, and combine those. The result is passed back into our decoder for <code>Video</code>.<pre tabindex="0"><code><span class="h">decode</span><span class="f"> : Decoder Video</span>
<span class="h">decode</span><span class="f"> =</span>
    JD<span class="f">.</span>map2 Video
        (JD<span class="f">.</span>field <span class="e">"id"</span> JD<span class="f">.</span>string)
        decodeFilename


<span class="h">decodeFilename</span><span class="f"> : Decoder String</span>
<span class="h">decodeFilename</span><span class="f"> =</span>
    JD<span class="f">.</span>map2 (<span class="f">\</span>extension name <span class="g">-&gt;</span> name <span class="g">++</span><span class="e"> "."</span><span class="g"> ++</span> extension)
        (JD<span class="f">.</span>field <span class="e">"extension"</span> JD<span class="f">.</span>string)
        (JD<span class="f">.</span>field <span class="e">"name"</span> JD<span class="f">.</span>string)
</code></pre><p>The code, in the end, is more readable and easier to extend. The decoder is also reusable for other JSON objects that have the same properties. If we want to add a new property to <code>Video</code>, we need to change <code>JD.map2</code> to <code>JD.map3</code> and add our new field.</section><footer>Published on <time datetime="2021-11-15T00:00:00+00:00" itemprop="datePublished">2021-11-15 </time><br>Tags: <a href="/tags/#decoding" title="See all post for Decoding">Decoding</a>, <a href="/tags/#elm" title="See all post for Elm">Elm</a>, <a href="/tags/#json" title="See all post for JSON">JSON</a><br>Source <a href="https://github.com/brianvanburken/brianvanburken.github.io/tree/master/_posts/2021-11-15-combine-properties-when-decoding-json-in-elm.md" target="_blank" rel="noopener noreferrer">on Github</a></footer></article><script data-goatcounter="https://brianvanburken.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script><noscript><img src="https://brianvanburken.goatcounter.com/count?p=/combine-properties-when-decoding-json-in-elm/"></noscript>