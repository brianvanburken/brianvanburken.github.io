<!DOCTYPE html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/atom+xml title="RSS Feed" href=https://brianvanburken.nl/feed.xml><title>Combine Properties when Decoding JSON in Elm | Brian van Burken</title><meta property=og:title content="Combine Properties when Decoding JSON in Elm"><meta name=description content="Combining two properties extracted from a JSON-object when decoding JSON in Elm."><meta property=og:description content="Combining two properties extracted from a JSON-object when decoding JSON in Elm."><meta property=og:type content=article><meta property=og:url content=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;combine-properties-when-decoding-json-in-elm&#x2F;><meta property=og:site_name content="Brian van Burken"><link rel=canonical href=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;combine-properties-when-decoding-json-in-elm&#x2F;><meta property=article:published_time content=2021-11-15T00:00:00+00:00><style>html{color:#fff;background:#0b0e14}@media (prefers-color-scheme:light){html{color:#0b0e14;background:#fff}}body{font-family:"Avenir Next","Open Sans",Helvetica,sans-serif;font-size:1.125rem;max-width:70ch;margin:1.5rem auto;padding:0 1.5rem}article,code,footer,h1,h2,p,pre{margin:1.5rem 0;line-height:1.5rem}h1{font-size:2.5rem;line-height:3rem}p{text-align:justify}img{max-width:100%}h2{margin-top:3rem}a,a code{color:#fa3}a:visited{color:#ff9500}a:focus,a:hover{color:#ffbf66}footer{border-top:1px solid #bfbdb6;padding-top:1.5rem}code,pre{font-size:.875rem;word-spacing:normal;word-break:normal;word-wrap:normal;hyphens:none;color:#bfbdb6;background:#0b0e14;border-radius:.375rem}pre{overflow:auto;padding:1.5rem}p code{line-height:1;outline:3px solid #0b0e14;margin:0 2px}.f{color:#ff8f40}.b{color:#bfbdb6}.g{color:#f29668}.c{color:#39bae6}.d{color:#bfbdb6b3}.e{color:#aad94c}.h{color:#ffb454}</style><p><a href=/ title="Overview of all my writings">Writings</a> | <a href=https://github.com/brianvanburken title="Visit my GitHub profile" target=_blank rel="noopener noreferrer">GitHub</a> | <a href=https://linkedin.com/in/brianvanburken title="Visit my LinkedIn profile" target=_blank rel="noopener noreferrer">LinkedIn</a><article itemscope itemtype=http://schema.org/BlogPosting><h1 itemprop="name headline">Combine Properties when Decoding JSON in Elm</h1><section itemprop=articleBody><p>Sometimes an API returns a JSON object that contains properties you want to combine, for example, pieces of information belonging together.<h2 id=the-domain>The domain</h2><p>Before we look at how to solve this, let's establish a shared domain. So let's say we have an API that returns a list of videos when called. Each video coming from that API has the following structure:<pre><code><span class=a><span class=b>{</span></span>
<span class=a><span class=c>  "id"</span><span class=d>:</span><span class=e> "1"</span><span class=d>,</span></span>
<span class=a><span class=c>  "extension"</span><span class=d>:</span><span class=e> "mp4"</span><span class=d>,</span></span>
<span class=a><span class=c>  "name"</span><span class=d>:</span><span class=e> "example"</span></span>
<span class=a><span class=b>}</span></span>
</code></pre><p>Here we see that the <code>extension</code> and the <code>name</code> are separate properties of the video object. It would be nice to combine them to get the full filename and download the video. Based on the JSON object and our wish to combine properties, we can create our model in Elm.<pre><code><span class=a><span class=f>type alias Video</span><span class=g> =</span></span>
<span class=a><span class=b>    { id: </span><span class=f>String</span></span>
<span class=a><span class=d>    ,</span><span class=b> filename: </span><span class=f>String</span></span>
<span class=a><span class=b>    }</span></span>
</code></pre><h2 id=decoding>Decoding</h2><p>Now that we know our goal, we can create the decoder for our model. In this first attempt, we decode all the properties and pass them to a function. In the function, we combine the name and extension and pass it to our model.<pre><code><span class=a><span class=f>import</span><span class=b> Json</span><span class=f>.</span><span class=b>Decode </span><span class=f>as</span><span class=b> JD </span><span class=f>exposing</span><span class=b> (</span><span class=f>Decoder</span><span class=b>)</span></span>

<span class=a><span class=h>decode</span><span class=f> : Decoder Video</span></span>
<span class=a><span class=h>decode</span><span class=f> =</span></span>
<span class=a><span class=f>    let</span></span>
<span class=a><span class=b>        toVideo </span><span class=f>:</span><span class=b> String </span><span class=g>-></span><span class=b> String </span><span class=g>-></span><span class=b> String </span><span class=g>-></span><span class=b> Decoder Video</span></span>
<span class=a><span class=b>        toVideo id extension name </span><span class=f>=</span></span>
<span class=a><span class=b>            JD</span><span class=f>.</span><span class=b>succeed (Video id (name </span><span class=g>++</span><span class=e> "."</span><span class=g> ++</span><span class=b> extension))</span></span>
<span class=a><span class=f>    in</span></span>
<span class=a><span class=b>    JD</span><span class=f>.</span><span class=b>map3 toVideo</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"id"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"extension"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"name"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
</code></pre><p>This code works and does what we want. But, the code isn't straightforward and less extensible. What if the API returns more properties that we want to use? The <code>toVideo</code> function becomes longer and less readable. It is also more error-prone, e.g., accidentally swapping arguments.<h2 id=improving-the-decoder>Improving the decoder</h2><p>We can improve this by extracting the logic of combining the name and extension into a separate custom decoder. In the decoder, we get the whole JSON object, extract only the name, and combine those. The result is passed back into our decoder for <code>Video</code>.<pre><code><span class=a><span class=h>decode</span><span class=f> : Decoder Video</span></span>
<span class=a><span class=h>decode</span><span class=f> =</span></span>
<span class=a><span class=b>    JD</span><span class=f>.</span><span class=b>map2 Video</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"id"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        decodeFilename</span></span>


<span class=a><span class=h>decodeFilename</span><span class=f> : Decoder String</span></span>
<span class=a><span class=h>decodeFilename</span><span class=f> =</span></span>
<span class=a><span class=b>    JD</span><span class=f>.</span><span class=b>map2 (</span><span class=f>\</span><span class=b>extension name </span><span class=g>-></span><span class=b> name </span><span class=g>++</span><span class=e> "."</span><span class=g> ++</span><span class=b> extension)</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"extension"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        (JD</span><span class=f>.</span><span class=b>field </span><span class=e>"name"</span><span class=b> JD</span><span class=f>.</span><span class=b>string)</span></span>
</code></pre><p>The code, in the end, is more readable and easier to extend. The decoder is also reusable for other JSON objects that have the same properties. If we want to add a new property to <code>Video</code>, we need to change <code>JD.map2</code> to <code>JD.map3</code> and add our new field.</section><footer>Published on <time datetime=2021-11-15T00:00:00 itemprop=datePublished>2021-11-15</time><br>Tags: <a href=/tags/#decoding title="See all posts for Decoding">Decoding</a>, <a href=/tags/#elm title="See all posts for Elm">Elm</a>, <a href=/tags/#json title="See all posts for JSON">JSON</a><br>Source <a href=https:&#x2F;&#x2F;github.com&#x2F;brianvanburken&#x2F;brianvanburken.github.io&#x2F;tree&#x2F;master&#x2F;content/combine-properties-when-decoding-json-in-elm.md target=_blank rel="noopener noreferrer" title="View post source on Github">on Github</a></footer></article><script data-goatcounter=https://brianvanburken.goatcounter.com/count async src=https://gc.zgo.at/count.js></script><noscript><img src="https://brianvanburken.goatcounter.com/count?p=/combine-properties-when-decoding-json-in-elm/"></noscript>