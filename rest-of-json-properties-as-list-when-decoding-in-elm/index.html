<!DOCTYPE html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/atom+xml title="RSS Feed" href=https://brianvanburken.nl/feed.xml><title>JSON Properties as a List when Decoding in Elm | Brian van Burken</title><meta property=og:title content="JSON Properties as a List when Decoding in Elm"><meta name=description content="Storing JSON properties as a List when decoding in Elm"><meta property=og:description content="Storing JSON properties as a List when decoding in Elm"><meta property=og:type content=article><meta property=og:url content=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;rest-of-json-properties-as-list-when-decoding-in-elm&#x2F;><meta property=og:site_name content="Brian van Burken"><link rel=canonical href=https:&#x2F;&#x2F;brianvanburken.nl&#x2F;rest-of-json-properties-as-list-when-decoding-in-elm&#x2F;><meta property=article:published_time content=2021-11-20T00:00:00+00:00><style>html{color:#fff;background:#0b0e14}@media (prefers-color-scheme:light){html{color:#0b0e14;background:#fff}}body{font-family:"Avenir Next","Open Sans",Helvetica,sans-serif;font-size:1.125rem;max-width:70ch;margin:1.5rem auto;padding:0 1.5rem}article,code,footer,h1,h2,p,pre{margin:1.5rem 0;line-height:1.5rem}h1{font-size:2.5rem;line-height:3rem}p{text-align:justify}img{max-width:100%}h2{margin-top:3rem}a,a code{color:#fa3}a:visited{color:#ff9500}a:focus,a:hover{color:#ffbf66}footer{border-top:1px solid #bfbdb6;padding-top:1.5rem}code,pre{font-size:.875rem;word-spacing:normal;word-break:normal;word-wrap:normal;hyphens:none;color:#bfbdb6;background:#0b0e14;border-radius:.375rem}pre{overflow:auto;padding:1.5rem}p code{line-height:1;outline:3px solid #0b0e14;margin:0 2px}.g{color:#ff8f40}.i{color:#59c2ff}.b{color:#bfbdb6}.h{color:#f29668}.c{color:#39bae6}.d{color:#bfbdb6b3}.e{color:#aad94c}.j{color:#ffb454}.f{color:#d2a6ff}</style><p><a href=/ title="Overview of all my writings">Writings</a> | <a href=https://github.com/brianvanburken title="Visit my GitHub profile" target=_blank rel="noopener noreferrer">GitHub</a> | <a href=https://linkedin.com/in/brianvanburken title="Visit my LinkedIn profile" target=_blank rel="noopener noreferrer">LinkedIn</a><article itemscope itemtype=http://schema.org/BlogPosting><h1 itemprop="name headline">JSON Properties as a List when Decoding in Elm</h1><section itemprop=articleBody><p>While working on an Elm application, I stumbled across a situation where I needed to decode a result from an API and store the rest of the properties that aren't part of the model as a list.<h2 id=setting-the-domain>Setting the domain</h2><p>The API returns a list of videos, and each video has an <code>id</code> and <code>title</code>. Each video also has any number of properties that are "metadata." These properties are what we want to store in a list of key-value pairs. An example video would look like this in JSON.<pre><code><span class=a><span class=b>{</span></span>
<span class=a><span class=c>  "id"</span><span class=d>:</span><span class=e> "1"</span><span class=d>,</span></span>
<span class=a><span class=c>  "duration"</span><span class=d>:</span><span class=f> 126</span><span class=d>,</span></span>
<span class=a><span class=c>  "language"</span><span class=d>:</span><span class=e> "EN"</span><span class=d>,</span></span>
<span class=a><span class=c>  "title"</span><span class=d>:</span><span class=e> "Example title"</span></span>
<span class=a><span class=b>}</span></span>
</code></pre><p>We then define the model where we store the metadata in a list of tuples. Each tuple contains the key and the value.<pre><code><span class=a><span class=g>type alias Video</span><span class=h> =</span></span>
<span class=a><span class=b>    { </span><span class=i>id</span><span class=g> : String</span></span>
<span class=a><span class=d>    ,</span><span class=i> title</span><span class=g> : String</span></span>
<span class=a><span class=d>    ,</span><span class=i> metadata</span><span class=g> : List</span><span class=b> ( </span><span class=g>String</span><span class=d>,</span><span class=g> String</span><span class=b> )</span></span>
<span class=a><span class=b>    }</span></span>
</code></pre><p>Using standard decoding in Elm, we first pass the JSON fields <code>id</code> and <code>title</code> to the model. And as of last, we pass a custom decoder.<pre><code><span class=a><span class=g>import</span><span class=b> Json</span><span class=g>.</span><span class=b>Decode </span><span class=g>as</span><span class=b> JD</span></span>

<span class=a><span class=j>decoder</span><span class=g> :</span><span class=b> JD</span><span class=g>.Decoder Video</span></span>
<span class=a><span class=j>decoder</span><span class=g> =</span></span>
<span class=a><span class=b>    JD</span><span class=g>.</span><span class=b>map3 Video</span></span>
<span class=a><span class=b>        (JD</span><span class=g>.</span><span class=b>field </span><span class=e>"id"</span><span class=b> JD</span><span class=g>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        (JD</span><span class=g>.</span><span class=b>field </span><span class=e>"title"</span><span class=b> JD</span><span class=g>.</span><span class=b>string)</span></span>
<span class=a><span class=b>        metadataDecoder</span></span>
</code></pre><h2 id=extracting-the-rest-of-json-properties>Extracting the rest of JSON properties</h2><p>Our custom decoder gets the whole JSON object and decodes it as a list of key-value pairs. We convert all the values to a <code>String</code> with the <code>valueToString</code> function, so all are the same type. However, this does mean that we lose the information. You could fix this by writing a <a rel="noopener nofollow noreferrer external" target=_blank href=https://guide.elm-lang.org/types/custom_types.html>Custom Type</a> for each value type; not needed for this case.<pre><code><span class=a><span class=j>metadataDecoder</span><span class=g> :</span><span class=b> JD</span><span class=g>.Decoder</span><span class=b> (</span><span class=g>List</span><span class=b> ( </span><span class=g>String</span><span class=d>,</span><span class=g> String</span><span class=b> ))</span></span>
<span class=a><span class=j>metadataDecoder</span><span class=g> =</span></span>
<span class=a><span class=b>    JD</span><span class=g>.</span><span class=b>keyValuePairs valueToString</span></span>

<span class=a><span class=j>valueToString</span><span class=g> :</span><span class=b> JD</span><span class=g>.Decoder String</span></span>
<span class=a><span class=j>valueToString</span><span class=g> =</span></span>
<span class=a><span class=b>    JD</span><span class=g>.</span><span class=b>oneOf</span></span>
<span class=a><span class=b>        [ JD</span><span class=g>.</span><span class=b>string</span></span>
<span class=a><span class=d>        ,</span><span class=b> JD</span><span class=g>.</span><span class=b>float </span><span class=h>|></span><span class=b> JD</span><span class=g>.</span><span class=b>map String</span><span class=g>.</span><span class=b>fromFloat</span></span>
<span class=a><span class=d>        ,</span><span class=b> JD</span><span class=g>.</span><span class=b>bool</span></span>
<span class=a><span class=h>            |></span><span class=b> JD</span><span class=g>.</span><span class=b>map</span></span>
<span class=a><span class=b>                (</span><span class=g>\</span><span class=b>boolean </span><span class=h>-></span></span>
<span class=a><span class=g>                    case </span><span class=b>boolean </span><span class=g>of</span></span>
<span class=a><span class=b>                        True </span><span class=h>-></span></span>
<span class=a><span class=e>                            "true"</span></span>

<span class=a><span class=b>                        False </span><span class=h>-></span></span>
<span class=a><span class=e>                            "false"</span></span>
<span class=a><span class=b>                )</span></span>
<span class=a><span class=d>        ,</span><span class=b> JD</span><span class=g>.</span><span class=b>null </span><span class=e>""</span></span>
<span class=a><span class=b>        ]</span></span>
</code></pre><p>So where done right? Well, we have everything as key-value pair. And I mean everything. We also added our <code>id</code> and <code>title</code> to <code>metadata</code>. Not ideal.<h2 id=block-unwanted-properties>Block unwanted properties</h2><p>To fix this, we need to filter out properties using a blocklist. We map our key-value pairs to a <code>filterMetadata</code> method. This method checks for each key against the blocklist. Instead of a blocklist, we could also use an allowlist to only add specific keys to the metadata.<pre><code><span class=a><span class=j>metadataDecoder</span><span class=g> :</span><span class=b> JD</span><span class=g>.Decoder</span><span class=b> (</span><span class=g>List</span><span class=b> ( </span><span class=g>String</span><span class=d>,</span><span class=g> String</span><span class=b> ))</span></span>
<span class=a><span class=j>metadataDecoder</span><span class=g> =</span></span>
<span class=a><span class=b>    JD</span><span class=g>.</span><span class=b>keyValuePairs valueToString</span></span>
<span class=a><span class=h>        |></span><span class=b> JD</span><span class=g>.</span><span class=b>map filterMetadata</span></span>

<span class=a><span class=j>filterMetadata</span><span class=g> : List</span><span class=b> ( </span><span class=g>String</span><span class=d>,</span><span class=g> String</span><span class=b> ) </span><span class=h>-></span><span class=g> List</span><span class=b> ( </span><span class=g>String</span><span class=d>,</span><span class=g> String</span><span class=b> )</span></span>
<span class=a><span class=j>filterMetadata</span><span class=g> =</span></span>
<span class=a><span class=g>    let</span></span>
<span class=a><span class=b>        blocklist </span><span class=g>=</span></span>
<span class=a><span class=b>            [ </span><span class=e>"id"</span><span class=d>,</span><span class=e> "title"</span><span class=b> ]</span></span>

<span class=a><span class=b>        isBlocked </span><span class=g>=</span></span>
<span class=a><span class=b>            Tuple</span><span class=g>.</span><span class=b>first</span></span>
<span class=a><span class=h>                >></span><span class=b> (</span><span class=g>\</span><span class=b>k </span><span class=h>-></span><span class=b> List</span><span class=g>.</span><span class=b>member k blocklist)</span></span>
<span class=a><span class=h>                >></span><span class=b> not</span></span>
<span class=a><span class=g>    in</span></span>
<span class=a><span class=b>    List</span><span class=g>.</span><span class=b>filter isBlocked</span></span>

</code></pre><p>In the end, we have a correct model with all the rest of the properties from the JSON object.<p>You can check out the final here: <a rel="noopener nofollow noreferrer external" target=_blank href=https://ellie-app.com/9Qxk3RDydTka1>https://ellie-app.com/9Qxk3RDydTka1</a></section><footer>Published on <time datetime=2021-11-20T00:00:00 itemprop=datePublished>2021-11-20</time><br>Tags: <a href=/tags/#decoding title="See all posts for Decoding">Decoding</a>, <a href=/tags/#elm title="See all posts for Elm">Elm</a>, <a href=/tags/#json title="See all posts for JSON">JSON</a><br>Source <a href=https:&#x2F;&#x2F;github.com&#x2F;brianvanburken&#x2F;brianvanburken.github.io&#x2F;tree&#x2F;master&#x2F;content/rest-of-json-properties-as-list-when-decoding-in-elm.md target=_blank rel="noopener noreferrer" title="View post source on Github">on Github</a></footer></article><script data-goatcounter=https://brianvanburken.goatcounter.com/count async src=https://gc.zgo.at/count.js></script><noscript><img src="https://brianvanburken.goatcounter.com/count?p=/rest-of-json-properties-as-list-when-decoding-in-elm/"></noscript>